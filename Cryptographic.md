# A02:2021 - Cryptographic Failures

## Theory

Cryptography is used to encode a text or a message with a secret code. The aim is to hide the content of the message to other people. To read the content of the message, you need to use the secret key. We used cryptography for a long time in different kind of domain such as military or IT. During wars, the cryptography has been used to transmit messages to the allies.

Nowadays, we use a lot cryptography of IT to hide sensitive data such as passwords. Using cryptography in IT, can involve some problems like exposing sensitive data because of a broken or risky crypto algorithm.To avoid cryptography issues, you need to determine the protection you need for your data that is in transit or at rest. If you are dealing with some credit cards information or personal information, your data will need more protection.

So, it is important to think about the following questions: are you using a non-secure protocol such as HTTP?; Are you using old or weak cryptography algorithms, or protocol? ; Is your crypto key are correctly managed (weak key, leakage from a key)? ; Are you sure that your data is encrypted? ; Does the certificate received from the server is validated and correct? Do you use some deprecated hash function?

Sources: https://www.kaspersky.com/resource-center/definitions/what-is-cryptographyÂ 
         https://www.geeksforgeeks.org/cryptography-and-its-types/

## Practicalities

Cryptographic failure is the root cause for sensitive data exposure. According to the Open Web Application Security Project (OWASP) 2021, securing your data against cryptographic failures has become more important than ever.

A cryptographic failure flaw can occur when you do the following:

+ Store or transit data in clear text (most common)
+ Protect data with an old or weak encryption
+ Improperly filter or mask data in transit

Source: https://support.f5.com/csp/article/K00174750

## Example Attack Scenarios

### Scenario #1: 
An application encrypts credit card numbers in a database using automatic database encryption. However, this data is automatically decrypted when retrieved, allowing a SQL injection flaw to retrieve credit card numbers in clear text.

### Scenario #2: 
A site doesn't use or enforce TLS for all pages or supports weak encryption. An attacker monitors network traffic (e.g., at an insecure wireless network), downgrades connections from HTTPS to HTTP, intercepts requests, and steals the user's session cookie. The attacker then replays this cookie and hijacks the user's (authenticated) session, accessing or modifying the user's private data. Instead of the above they could alter all transported data, e.g., the recipient of a money transfer.

### Scenario #3: 
The password database uses unsalted or simple hashes to store everyone's passwords. A file upload flaw allows an attacker to retrieve the password database. All the unsalted hashes can be exposed with a rainbow table of pre-calculated hashes. Hashes generated by simple or fast hash functions may be cracked by GPUs, even if they were salted.

Source: https://owasp.org/Top10/A02_2021-Cryptographic_Failures/ 

Cryptographic failure attack scenario: 

<img width="865" alt="image" src="https://user-images.githubusercontent.com/90892301/214536561-35e74a8c-4835-476c-b6ed-f83c89ea8d50.png">

Source: https://support.f5.com/csp/article/K00174750

